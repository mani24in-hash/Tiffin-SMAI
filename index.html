<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Sanatan Mandir Atlanta Inc. – Tiffin Order Form</title>

<style>
  body { font-family: Arial, sans-serif; background: #f6f6f6; padding: 20px; }
  .container {
    max-width: 980px; background: #fff; margin: auto; padding: 25px;
    border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1);
  }

  .header { text-align: center; margin-bottom: 18px; }
  .header h1 { margin: 0; color: #b45309; }
  .header h1 span { display: block; font-size: 20px; font-weight: normal; margin-top: 6px; }
  .subtitle { margin-top: 10px; font-size: 14px; color: #444; }
  .divider { margin: 18px auto 0; max-width: 520px; border: none; border-top: 1px solid #eee; }

  .section-title {
    margin-top: 25px; color: #92400e;
    border-bottom: 1px solid #ddd; padding-bottom: 6px;
  }

  label { display: block; margin-top: 12px; font-weight: bold; }
  input[type="text"], input[type="email"], input[type="tel"],
  input[type="time"], textarea {
    width: 100%; padding: 10px; margin-top: 6px;
    border: 1px solid #ccc; border-radius: 6px; font-size: 14px;
  }

  .hint { font-size: 13px; color: #555; margin-top: 6px; }

  .day-picker {
    display: flex; flex-wrap: wrap; gap: 12px;
    margin-top: 10px; padding: 12px;
    border: 1px solid #ddd; border-radius: 10px; background: #fafafa;
  }
  .day-pill { font-weight: normal; margin: 0; }

  .selected-days {
    margin-top: 10px;
    font-size: 13px;
    color: #333;
    background: #fef3c7;
    border: 1px solid #fde68a;
    padding: 10px;
    border-radius: 10px;
    display: none;
  }

  .day-menu {
    display: none;
    margin-top: 18px; padding: 14px;
    border: 1px solid #eee; border-radius: 10px;
    background: #fff;
  }

  .items-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
  }
  .items-table th, .items-table td {
    border-bottom: 1px solid #eee;
    padding: 10px 8px;
    vertical-align: middle;
  }
  .items-table th { text-align: left; color: #444; font-size: 14px; }
  .price { font-weight: bold; white-space: nowrap; }

  .qty-input {
    width: 90px; padding: 8px;
    border: 1px solid #ccc; border-radius: 8px; font-size: 14px;
  }

  .total-box {
    margin-top: 18px; padding: 14px;
    border: 1px solid #ddd; border-radius: 12px;
    background: #fafafa;
    display: flex; justify-content: space-between; align-items: center;
  }
  .total-amount { font-size: 22px; font-weight: bold; color: #065f46; }

  .error {
    display: none;
    margin-top: 12px;
    padding: 10px;
    border-radius: 8px;
    background: #fff7ed;
    border: 1px solid #fed7aa;
    color: #9a3412;
  }

  .btn-row { display:flex; gap:12px; margin-top: 16px; flex-wrap: wrap; }
  button, .secondary-btn {
    width: 100%;
    padding: 12px;
    border: none;
    font-size: 16px;
    cursor: pointer;
    border-radius: 8px;
  }
  button { background: #b45309; color: #fff; }
  button:hover { background: #92400e; }
  .secondary-btn {
    background: #111827; color:#fff; text-decoration:none; text-align:center;
  }
  .secondary-btn:hover { background:#0b1220; }

  /* Receipt box */
  .receipt-wrap {
    display: none;
    margin-top: 26px;
    padding: 16px;
    border: 1px solid #e5e7eb;
    border-radius: 12px;
    background: #ffffff;
  }
  .receipt-title { margin:0; color:#111827; }
  .receipt-sub { margin:6px 0 0; color:#374151; font-size: 13px; }
  .receipt-grid {
    margin-top: 12px;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px 18px;
    font-size: 14px;
  }
  .receipt-grid div b { color:#111827; }
  .receipt-items { margin-top: 14px; }
  .receipt-items h4 { margin: 12px 0 6px; color:#92400e; }
  .receipt-items ul { margin: 0 0 6px 18px; padding: 0; }
  .receipt-total {
    margin-top: 12px;
    padding-top: 12px;
    border-top: 1px dashed #d1d5db;
    display:flex; justify-content: space-between; align-items:center;
    font-size: 16px;
  }
  .receipt-total b { font-size: 18px; color:#065f46; }

  /* QR section */
  .qr-wrap {
    text-align: center;
    margin-top: 26px;
    padding-top: 18px;
    border-top: 1px solid #eee;
  }
  .qr-wrap img {
    border: 1px solid #ddd; padding: 10px; border-radius: 10px;
    background: #fff;
  }
  .qr-link {
    display: inline-block;
    margin-top: 10px;
    font-size: 18px;
    font-weight: bold;
    text-decoration: none;
    color: #b45309;
  }
  .qr-url {
    font-size: 12px;
    color: #666;
    margin-top: 8px;
    word-break: break-all;
  }

  /* Print only receipt */
  @media print {
    body { background: #fff; padding: 0; }
    .container > *:not(.receipt-wrap) { display: none !important; }
    .receipt-wrap { display: block !important; border: none; padding: 0; }
    .print-hide { display: none !important; }
  }
</style>
</head>

<body>
<div class="container">

  <div class="header">
    <h1>
      Sanatan Mandir Atlanta Inc.
      <span>Tiffin Order Form</span>
    </h1>
    <div class="subtitle">
      Pickup Address: 1281 Cooper Lake Road SE, Smyrna, GA 30082
    </div>
    <hr class="divider">
  </div>

  <form id="orderForm" action="https://formspree.io/f/xeeeqjrn" method="POST">
    <input type="hidden" name="_subject" value="New Tiffin Order – Sanatan Mandir Atlanta Inc.">
    <input type="hidden" name="total_amount" id="totalAmount" value="0.00">

    <h2 class="section-title">Customer Details</h2>

    <label>Full Name *</label>
    <input type="text" name="name" id="nameInput" required>

    <label>Phone *</label>
    <input type="tel" name="phone" id="phoneInput" required>

    <label>Email *</label>
    <input type="email" name="email" id="emailInput" required>

    <label>Pickup Time *</label>
    <input type="time" name="pickup_time" id="pickupTimeInput" required>

    <h2 class="section-title">Select Day(s) of the Week *</h2>
    <div class="hint">
      Choose one or more days. Only those menu(s) will appear. Enter quantity (0 = not selected).
    </div>

    <div class="day-picker">
      <label class="day-pill"><input type="checkbox" data-day="Monday" name="selected_days[]" value="Monday"> Monday</label>
      <label class="day-pill"><input type="checkbox" data-day="Tuesday" name="selected_days[]" value="Tuesday"> Tuesday</label>
      <label class="day-pill"><input type="checkbox" data-day="Wednesday" name="selected_days[]" value="Wednesday"> Wednesday</label>
      <label class="day-pill"><input type="checkbox" data-day="Thursday" name="selected_days[]" value="Thursday"> Thursday</label>
      <label class="day-pill"><input type="checkbox" data-day="Friday" name="selected_days[]" value="Friday"> Friday</label>
    </div>

    <div id="selectedDaysBox" class="selected-days"></div>

    <div id="dayError" class="error">Please select at least one day of the week.</div>
    <div id="qtyError" class="error">Please enter quantity (greater than 0) for at least one item.</div>

    <!-- TOTAL (updated with payment note) -->
    <div class="total-box" aria-live="polite">
      <div>
        <strong>Total Amount</strong>
        <div style="font-size:13px; color:#374151; margin-top:4px;">
          To be paid at temple during pick up
        </div>
      </div>
      <div class="total-amount" id="totalDisplay">$0.00</div>
    </div>

    <h2 class="section-title">Menu</h2>

    <!-- MONDAY -->
    <div class="day-menu" id="menu-Monday" data-daywrap="Monday">
      <h3 style="margin:0; color:#92400e;">Monday</h3>
      <table class="items-table">
        <thead><tr><th>Item</th><th class="price">Unit Price</th><th>Qty</th></tr></thead>
        <tbody>
          <tr>
            <td>Full Tiffin – Pav Bhaji, Tava Pulav &amp; Raita</td>
            <td class="price">$10.00</td>
            <td><input class="qty-input" type="number" min="0" step="1" value="0"
              name="Monday_Full_Tiffin_qty" data-day="Monday" data-item="Full Tiffin – Pav Bhaji, Tava Pulav & Raita" data-price="10"></td>
          </tr>
          <tr>
            <td>Bhaji (per lb)</td>
            <td class="price">$7.00</td>
            <td><input class="qty-input" type="number" min="0" step="1" value="0"
              name="Monday_Bhaji_qty" data-day="Monday" data-item="Bhaji (per lb)" data-price="7"></td>
          </tr>
          <tr>
            <td>Tava Pulav (per lb)</td>
            <td class="price">$7.00</td>
            <td><input class="qty-input" type="number" min="0" step="1" value="0"
              name="Monday_Tava_Pulav_qty" data-day="Monday" data-item="Tava Pulav (per lb)" data-price="7"></td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- TUESDAY -->
    <div class="day-menu" id="menu-Tuesday" data-daywrap="Tuesday">
      <h3 style="margin:0; color:#92400e;">Tuesday</h3>
      <table class="items-table">
        <thead><tr><th>Item</th><th class="price">Unit Price</th><th>Qty</th></tr></thead>
        <tbody>
          <tr>
            <td>Full Tiffin – Chole, Puri, Kheer &amp; Jeera Rice</td>
            <td class="price">$10.00</td>
            <td><input class="qty-input" type="number" min="0" step="1" value="0"
              name="Tuesday_Full_Tiffin_qty" data-day="Tuesday" data-item="Full Tiffin – Chole, Puri, Kheer & Jeera Rice" data-price="10"></td>
          </tr>
          <tr>
            <td>Chole</td>
            <td class="price">$7.00</td>
            <td><input class="qty-input" type="number" min="0" step="1" value="0"
              name="Tuesday_Chole_qty" data-day="Tuesday" data-item="Chole" data-price="7"></td>
          </tr>
          <tr>
            <td>Puri (per piece)</td>
            <td class="price">$0.50</td>
            <td><input class="qty-input" type="number" min="0" step="1" value="0"
              name="Tuesday_Puri_qty" data-day="Tuesday" data-item="Puri (per piece)" data-price="0.5"></td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- WEDNESDAY -->
    <div class="day-menu" id="menu-Wednesday" data-daywrap="Wednesday">
      <h3 style="margin:0; color:#92400e;">Wednesday</h3>
      <table class="items-table">
        <thead><tr><th>Item</th><th class="price">Unit Price</th><th>Qty</th></tr></thead>
        <tbody>
          <tr>
            <td>Full Tiffin – Tadka Dal, Cabbage, Potato Shaak, Paratha &amp; Jeera Rice</td>
            <td class="price">$10.00</td>
            <td><input class="qty-input" type="number" min="0" step="1" value="0"
              name="Wednesday_Full_Tiffin_qty" data-day="Wednesday" data-item="Full Tiffin – Tadka Dal, Cabbage, Potato Shaak, Paratha & Jeera Rice" data-price="10"></td>
          </tr>
          <tr>
            <td>Tadka Dal (per lb)</td>
            <td class="price">$7.00</td>
            <td><input class="qty-input" type="number" min="0" step="1" value="0"
              name="Wednesday_Tadka_Dal_qty" data-day="Wednesday" data-item="Tadka Dal (per lb)" data-price="7"></td>
          </tr>
          <tr>
            <td>Potato Shaak (per lb)</td>
            <td class="price">$7.00</td>
            <td><input class="qty-input" type="number" min="0" step="1" value="0"
              name="Wednesday_Potato_Shaak_qty" data-day="Wednesday" data-item="Potato Shaak (per lb)" data-price="7"></td>
          </tr>
          <tr>
            <td>Paratha (per piece)</td>
            <td class="price">$1.00</td>
            <td><input class="qty-input" type="number" min="0" step="1" value="0"
              name="Wednesday_Paratha_qty" data-day="Wednesday" data-item="Paratha (per piece)" data-price="1"></td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- THURSDAY -->
    <div class="day-menu" id="menu-Thursday" data-daywrap="Thursday">
      <h3 style="margin:0; color:#92400e;">Thursday</h3>
      <table class="items-table">
        <thead><tr><th>Item</th><th class="price">Unit Price</th><th>Qty</th></tr></thead>
        <tbody>
          <tr>
            <td>Full Tiffin – Daal Dhokli, Sambharo, Masala Bhakri &amp; Rice</td>
            <td class="price">$10.00</td>
            <td><input class="qty-input" type="number" min="0" step="1" value="0"
              name="Thursday_Full_Tiffin_qty" data-day="Thursday" data-item="Full Tiffin – Daal Dhokli, Sambharo, Masala Bhakri & Rice" data-price="10"></td>
          </tr>
          <tr>
            <td>Daal Dhokli</td>
            <td class="price">$7.00</td>
            <td><input class="qty-input" type="number" min="0" step="1" value="0"
              name="Thursday_Daal_Dhokli_qty" data-day="Thursday" data-item="Daal Dhokli" data-price="7"></td>
          </tr>
          <tr>
            <td>Masala Bhakri (per piece)</td>
            <td class="price">$1.00</td>
            <td><input class="qty-input" type="number" min="0" step="1" value="0"
              name="Thursday_Masala_Bhakri_qty" data-day="Thursday" data-item="Masala Bhakri (per piece)" data-price="1"></td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- FRIDAY -->
    <div class="day-menu" id="menu-Friday" data-daywrap="Friday">
      <h3 style="margin:0; color:#92400e;">Friday</h3>
      <table class="items-table">
        <thead><tr><th>Item</th><th class="price">Unit Price</th><th>Qty</th></tr></thead>
        <tbody>
          <tr>
            <td>Full Tiffin – Idli, Sambhar &amp; Coconut Chutney</td>
            <td class="price">$10.00</td>
            <td><input class="qty-input" type="number" min="0" step="1" value="0"
              name="Friday_Full_Tiffin_qty" data-day="Friday" data-item="Full Tiffin – Idli, Sambhar & Coconut Chutney" data-price="10"></td>
          </tr>
          <tr>
            <td>Sambhar</td>
            <td class="price">$7.00</td>
            <td><input class="qty-input" type="number" min="0" step="1" value="0"
              name="Friday_Sambhar_qty" data-day="Friday" data-item="Sambhar" data-price="7"></td>
          </tr>
          <tr>
            <td>Idli (per piece)</td>
            <td class="price">$1.00</td>
            <td><input class="qty-input" type="number" min="0" step="1" value="0"
              name="Friday_Idli_qty" data-day="Friday" data-item="Idli (per piece)" data-price="1"></td>
          </tr>
        </tbody>
      </table>
    </div>

    <h2 class="section-title">Additional Notes</h2>
    <textarea name="notes" id="notesInput" rows="4" placeholder="Any special instructions..."></textarea>

    <div class="btn-row print-hide">
      <button type="submit">Submit Order</button>
      <a class="secondary-btn" href="javascript:void(0)" id="printBtn">Print Receipt</a>
    </div>
  </form>

  <!-- Receipt Preview -->
  <div class="receipt-wrap" id="receiptWrap" aria-live="polite">
    <h2 class="receipt-title">Tiffin Order Receipt</h2>
    <div class="receipt-sub">Sanatan Mandir Atlanta Inc. • 1281 Cooper Lake Road SE, Smyrna, GA 30082</div>

    <div class="receipt-grid">
      <div><b>Name:</b> <span id="rName">-</span></div>
      <div><b>Phone:</b> <span id="rPhone">-</span></div>
      <div><b>Email:</b> <span id="rEmail">-</span></div>
      <div><b>Pickup Time:</b> <span id="rPickupTime">-</span></div>
    </div>

    <div class="receipt-items" id="rItems"></div>

    <!-- RECEIPT TOTAL (updated with payment note) -->
    <div class="receipt-total">
      <div>
        <b>Total</b>
        <div style="font-size:13px; color:#374151; margin-top:4px;">
          To be paid at temple during pick up
        </div>
      </div>
      <div><b id="rTotal">$0.00</b></div>
    </div>

    <div class="receipt-sub" style="margin-top:10px;">
      Please bring this receipt at pickup (printed or on phone).
    </div>
  </div>

  <!-- QR Code -->
  <div class="qr-wrap">
    <img id="qrImg" width="220" height="220" alt="Tiffin Order Form QR Code">
    <div>
      <a class="qr-link" id="qrLink" target="_blank">Tiffin Order Form</a>
    </div>
    <div class="qr-url">QR opens: <span id="qrUrlText"></span></div>
  </div>

</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  // QR
  const destinationUrl = window.location.href;
  document.getElementById('qrImg').src =
    'https://api.qrserver.com/v1/create-qr-code/?size=220x220&data=' + encodeURIComponent(destinationUrl);
  document.getElementById('qrLink').href = destinationUrl;
  document.getElementById('qrUrlText').textContent = destinationUrl;

  const form = document.getElementById('orderForm');
  const dayCheckboxes = Array.from(document.querySelectorAll('input[type="checkbox"][data-day]'));
  const totalDisplay = document.getElementById('totalDisplay');
  const totalAmount = document.getElementById('totalAmount');
  const dayError = document.getElementById('dayError');
  const qtyError = document.getElementById('qtyError');
  const selectedDaysBox = document.getElementById('selectedDaysBox');

  const nameInput = document.getElementById('nameInput');
  const phoneInput = document.getElementById('phoneInput');
  const emailInput = document.getElementById('emailInput');
  const pickupTimeInput = document.getElementById('pickupTimeInput');
  const notesInput = document.getElementById('notesInput');

  const receiptWrap = document.getElementById('receiptWrap');
  const rName = document.getElementById('rName');
  const rPhone = document.getElementById('rPhone');
  const rEmail = document.getElementById('rEmail');
  const rPickupTime = document.getElementById('rPickupTime');
  const rItems = document.getElementById('rItems');
  const rTotal = document.getElementById('rTotal');

  function sanitizeQty(input) {
    let v = parseInt(input.value || "0", 10);
    if (Number.isNaN(v) || v < 0) v = 0;
    input.value = v;
    return v;
  }

  function calculateTotal() {
    let total = 0;
    document.querySelectorAll('.day-menu').forEach(menu => {
      if (menu.style.display !== 'none') {
        menu.querySelectorAll('input.qty-input').forEach(qtyInput => {
          const qty = sanitizeQty(qtyInput);
          const price = parseFloat(qtyInput.dataset.price || "0");
          if (qty > 0 && !Number.isNaN(price)) total += qty * price;
        });
      }
    });
    totalDisplay.textContent = `$${total.toFixed(2)}`;
    totalAmount.value = total.toFixed(2);
    return total;
  }

  function updateMenus() {
    const selected = [];
    dayCheckboxes.forEach(cb => {
      const day = cb.dataset.day;
      const menu = document.getElementById('menu-' + day);
      if (!menu) return;

      if (cb.checked) {
        menu.style.display = 'block';
        selected.push(day);
      } else {
        menu.style.display = 'none';
        menu.querySelectorAll('input.qty-input').forEach(i => i.value = 0);
      }
    });

    if (selected.length) {
      selectedDaysBox.style.display = 'block';
      selectedDaysBox.textContent = `Selected day(s): ${selected.join(', ')}. Scroll down to see the menu(s).`;
    } else {
      selectedDaysBox.style.display = 'none';
      selectedDaysBox.textContent = '';
    }

    dayError.style.display = 'none';
    qtyError.style.display = 'none';
    calculateTotal();
    buildReceiptPreview();
  }

  function buildReceiptPreview() {
    const allQtyInputs = Array.from(document.querySelectorAll('input.qty-input'));
    const anyQty = allQtyInputs.some(i => parseInt(i.value || "0", 10) > 0);
    const anyDay = dayCheckboxes.some(cb => cb.checked);

    if (!anyDay && !anyQty) {
      receiptWrap.style.display = 'none';
      return;
    }
    receiptWrap.style.display = 'block';

    rName.textContent = (nameInput.value || "").trim() || "-";
    rPhone.textContent = (phoneInput.value || "").trim() || "-";
    rEmail.textContent = (emailInput.value || "").trim() || "-";
    rPickupTime.textContent = (pickupTimeInput.value || "").trim() || "-";

    const byDay = {};
    allQtyInputs.forEach(inp => {
      const qty = sanitizeQty(inp);
      if (qty <= 0) return;
      const day = inp.dataset.day || "Other";
      const item = inp.dataset.item || "Item";
      const price = parseFloat(inp.dataset.price || "0");
      if (!byDay[day]) byDay[day] = [];
      byDay[day].push({ item, qty, price });
    });

    let html = "";
    const daysInOrder = ["Monday","Tuesday","Wednesday","Thursday","Friday"];
    daysInOrder.forEach(day => {
      if (!byDay[day] || byDay[day].length === 0) return;
      html += `<h4>${day}</h4><ul>`;
      byDay[day].forEach(x => {
        const line = (x.qty * x.price);
        html += `<li>${x.qty} × ${escapeHtml(x.item)} — $${line.toFixed(2)}</li>`;
      });
      html += `</ul>`;
    });

    const notes = (notesInput.value || "").trim();
    if (notes) {
      html += `<h4>Notes</h4><div style="font-size:14px; color:#111827;">${escapeHtml(notes)}</div>`;
    }

    rItems.innerHTML = html || `<div style="font-size:14px; color:#6b7280;">No items selected yet.</div>`;
    const total = calculateTotal();
    rTotal.textContent = `$${total.toFixed(2)}`;
  }

  function escapeHtml(str) {
    return String(str)
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }

  dayCheckboxes.forEach(cb => cb.addEventListener('change', updateMenus));

  document.addEventListener('input', (e) => {
    if (e.target && e.target.classList && e.target.classList.contains('qty-input')) {
      sanitizeQty(e.target);
      calculateTotal();
      buildReceiptPreview();
    }
    if (e.target === nameInput || e.target === phoneInput || e.target === emailInput || e.target === pickupTimeInput || e.target === notesInput) {
      buildReceiptPreview();
    }
  });

  document.getElementById('printBtn').addEventListener('click', () => {
    buildReceiptPreview();
    window.print();
  });

  form.addEventListener('submit', (e) => {
    const anyDaySelected = dayCheckboxes.some(cb => cb.checked);
    if (!anyDaySelected) {
      e.preventDefault();
      dayError.style.display = 'block';
      dayError.scrollIntoView({ behavior: 'smooth', block: 'center' });
      return;
    }
    const total = calculateTotal();
    if (total <= 0) {
      e.preventDefault();
      qtyError.style.display = 'block';
      qtyError.scrollIntoView({ behavior: 'smooth', block: 'center' });
      return;
    }
  });

  updateMenus();
});
</script>

</body>
</html>
